"use strict";var FormationNewcomers=function(){function T(e){this.newcomers_array=[];var t=this;$(document).on("click",".newcomer-filter-area li",function(e){return t.doFilterNewcomer(e,!1),!1}),$(document).on("contextmenu",".newcomer-filter-area li",function(e){return t.doFilterNewcomer(e,!0),!1}),$(document).on("click",".do-toggle-check",function(e){return t.doToggleCheck(e),!1}),$(document).on("click","#newcomer-info li div.frame",function(e){return t.doOpenDialogNewcomer(e),!1}),$(document).on("click",".dialog-newcomer > div > ul > li",function(e){return t.doChangeDialogNewcomerStatus(e),!1}),$(document).on("click",".dialog-newcomer .do-cancel",function(e){return t.doDialogNewcomerCancel(e),!1}),$(document).on("click",".dialog-newcomer .do-ok",function(e){return t.doDialogNewcomerOk(e),!1}),this.prepareMembersArray(e),this.showNewcomers()}return T.prototype.doFilterNewcomer=function(e,t){var r=$(e.currentTarget);if(r.closest("div").hasClass("entry-newcomer-area"))r.addClass("selected"),$(".newcomer-area .entry-name-area li").removeClass("selected"),$(".newcomer-area .entry-attribute-area li").removeClass("selected"),$(".newcomer-area .entry-rarity-area li").removeClass("selected");else if(r.hasClass("radio-button")){var a=r.parent();$("li",a).not(r).removeClass("selected"),r.addClass("selected")}else if(t){(a=r.closest(".entry-name-area,.entry-attribute-area,.entry-rarity-area,.entry-skill-area")).find("li.selected").removeClass("selected"),r.addClass("selected"),$(".entry-newcomer-area li").removeClass("selected")}else r.toggleClass("selected"),$(".entry-newcomer-area li").removeClass("selected");this.showNewcomers()},T.prototype.doToggleCheck=function(e){var t=$(e.currentTarget).data("group"),r=$(e.currentTarget).parents("div.entry-name-area"),a=$("ul[data-group="+t+"]",r);$("li.selected",a).length==$("li",a).length?$("li",a).each(function(){$(this).removeClass("selected")}):$("li",a).each(function(){$(this).addClass("selected")}),this.showNewcomers()},T.prototype.doOpenDialogNewcomer=function(e){var t=$(e.currentTarget),r=t.data("extend"),a=t.closest("li").data("id"),l=this.getMemberInfoById(a);$(".dialog-newcomer").attr("data-id",a);var i=$("<div>").append(t.clone());$(".dialog-newcomer td.face").html(i.html()),$(".dialog-newcomer .crown").text(l.crown),$(".dialog-newcomer .skill").text(SfUtil.localize(SfUtil.SKILL_VALUE_SP[l.skill]));var o=T.KEY_CENTER_SKILL_MAP[l.center_skill]+"/",n=31&l.additional_center_skill;0!=n&&(o+=T.KEY_ADDITIONAL_CENTER_SKILL_MAP[n]),$(".dialog-newcomer .center-skill").text(SfUtil.getDisplayFullCenterSkill(l.attribute,o));var s=$(".dialog-newcomer ul.dialog-entry-extend");if(s.children().remove(),l.normal_icon){var d=$("<li>").appendTo(s).attr("data-value","false").text(SfUtil.localize("未覚醒button","未覚醒"));r||d.addClass("selected")}if(l.extend_icon){var c=$("<li>").appendTo(s).attr("data-value","true").text(SfUtil.localize("覚醒button","覚醒"));r&&c.addClass("selected")}var _=$(".dialog-newcomer ul.dialog-entry-slot");_.children().remove();for(var L=l.min_slot,f=l.max_slot,u=L;u<=f;u++){var m=$("<li>").appendTo(_).attr("data-value",u).text(u);u==L&&m.addClass("selected")}var S=$(".dialog-newcomer ul.dialog-entry-skilllv");S.children().remove();for(var C=1;C<=8;C++){var I=$("<li>").appendTo(S).attr("data-value",C).text(C);1==C&&I.addClass("selected")}$.colorbox({html:$("#dialog-club-member-src > .dialog-newcomer").clone(),transition:"fade",speed:100,fadeOut:50,overlayClose:!0,closeButton:!1,fixed:!1,scrolling:!1,maxWidth:"100%"})},T.prototype.doChangeDialogNewcomerStatus=function(e){var t=$(e.currentTarget);if(t.hasClass("check-box"))t.toggleClass("selected");else{var r=t.closest("ul");$("li",r).not(t).removeClass("selected"),t.addClass("selected")}},T.prototype.doDialogNewcomerOk=function(e){var t=$(e.currentTarget).closest(".dialog-newcomer"),r=t.data("id"),a=this.getMemberInfoById(r),l=$(".dialog-entry-extend li.selected",t).data("value"),i=$(".dialog-entry-slot li.selected",t).data("value"),o=$(".dialog-entry-skilllv li.selected",t).data("value"),n=new Array(SfUtil.COL_MEMO+1);n[SfUtil.COL_NAME]=T.DATA_NAME_MAP[a.name],n[SfUtil.COL_ATTRIBUTE]=T.DATA_ATTRIBUTE_MAP[a.attribute],n[SfUtil.COL_RARITY]=T.DATA_RARITY_MAP[a.rarity],n[SfUtil.COL_CROWN]=a.crown,n[SfUtil.COL_EXTEND]=l?"2.覚醒":"1.未覚醒",n[SfUtil.COL_SLOT]=i,n[SfUtil.COL_SKILL_LV]=o,n[SfUtil.COL_SKILL]=SfUtil.SKILL_VALUE[a.skill],n[SfUtil.COL_SKILL_TRIGGER]=SfUtil.SKILL_TRIGGER_VALUE[a.skill_trigger],n[SfUtil.COL_SKILL_FREQUENCY]=a.skill_level_data[o-1].frequency,n[SfUtil.COL_SKILL_PROBABILITY]=a.skill_level_data[o-1].probability,n[SfUtil.COL_SKILL_DURATION]=a.skill_level_data[o-1].duration,n[SfUtil.COL_SKILL_EFFECT]=a.skill_level_data[o-1].effect,n[SfUtil.COL_SMILE]=l?a.extend_smile:a.normal_smile,n[SfUtil.COL_PURE]=l?a.extend_pure:a.normal_pure,n[SfUtil.COL_COOL]=l?a.extend_cool:a.normal_cool,n[SfUtil.COL_CENTER_SKILL]=T.DATA_CENTER_SKILL_MAP[a.attribute][a.center_skill];var s=31&a.additional_center_skill;n[SfUtil.COL_ADDITIONAL_CENTER_SKILL]=T.DATA_ADDITIONAL_CENTER_SKILL_MAP[s],n[SfUtil.COL_ADDITIONAL_CENTER_SKILL]||(n[SfUtil.COL_ADDITIONAL_CENTER_SKILL]=""),n[SfUtil.COL_MEMO]="",this.newcomers_array.push(n);var d=$("<li>"),c=$("<div>").appendTo(d).addClass("frame").addClass(a.rarity.toLowerCase()).addClass(a.attribute),_=$("<div>").appendTo(c).addClass("bg");"sr"==a.rarity.toLowerCase()&&_.addClass(a.rarity.toLowerCase()).addClass(a.attribute),$("<img>").appendTo(_).attr("src","dat/icon-"+a.id+(l?"x":"n")+".png"),$("<div>").appendTo(c).addClass("skill-level").text(o);var L=$("td.face > div.frame",t);L.addClass("bubble");var f=$.Deferred();setTimeout(function(){L.removeClass("bubble");var e=d.clone();$("#cadet-info").append(e),f.resolve()},300),f.promise().done(function(){$.colorbox.close()})},T.prototype.doDialogNewcomerCancel=function(e){$.colorbox.close()},T.prototype.prepareMembersArray=function(e){for(var t in this.members_array=[],e){var r=e[t];for(var a in r){var l=r[a];for(var i in l){var o=l[i];for(var n in o){var s=o[n];s.name=t,s.attribute=SfUtil.getAttributeKey(SfUtil.getDisplayValue(a)),s.rarity=i.toLowerCase(),s.crown=n,this.members_array.push(s)}}}}this.members_array.sort(function(e,t){return e.id<t.id?1:e.id>t.id?-1:0})},T.prototype.showNewcomers=function(){$("#newcomer-info").children().remove();var r,a=[],i=[],o=[],n=[];r=0!=$(".entry-newcomer-area li.selected").length,$(".newcomer-filter-area .entry-name-area li.selected").each(function(){a.push($(this).data("value"))}),$(".newcomer-filter-area .entry-attribute-area li.selected").each(function(){i.push($(this).data("value"))}),$(".newcomer-filter-area .entry-rarity-area li.selected").each(function(){o.push($(this).data("value"))});var s=$(".newcomer-filter-area .entry-extend-area li.selected").data("value");$(".newcomer-filter-area .entry-skill-area li.selected").each(function(){n.push($(this).data("value"))});for(var d=0,e=function(e){var l=c.members_array[e];if("聖良"===l.name)return"continue";if("理亞"===l.name)return"continue";if(r){if(9<=d)return"continue"}else{if(-1==a.indexOf(l.name))return"continue";if(-1==i.indexOf(l.attribute))return"continue";if(-1==o.indexOf(l.rarity))return"continue";if(-1==n.indexOf(l.skill))return"continue"}function t(e){var t=$("<li>").appendTo("#newcomer-info").attr("data-id",l.id),r=$("<div>").appendTo(t).addClass("frame").addClass(l.rarity).addClass(l.attribute).attr("data-extend",String(e)),a=$("<div>").appendTo(r).addClass("bg");"sr"==l.rarity&&a.addClass(l.rarity).addClass(l.attribute),$("<img>").appendTo(a).attr("src","dat/icon-"+l.id+(e?"x":"n")+".png")}s?l.extend_icon&&(t(!0),d++):l.normal_icon&&(t(!1),d++)},c=this,t=0;t<this.members_array.length;t++)e(t)},T.prototype.getMemberInfoById=function(e){for(var t=0;t<this.members_array.length;t++){var r=this.members_array[t];if(r.id==e)return r}throw new Error("Invalid member id {"+e+"}")},T.KEY_CENTER_SKILL_MAP={1:SfUtil.CENTER_SKILL_POWER,2:SfUtil.CENTER_SKILL_HEART,3:SfUtil.CENTER_SKILL_STAR,4:SfUtil.CENTER_SKILL_PRINCESS,5:SfUtil.CENTER_SKILL_ANGEL,6:SfUtil.CENTER_SKILL_EMPRESS},T.KEY_ADDITIONAL_CENTER_SKILL_MAP={1:SfUtil.ADDITIONAL_CENTER_SKILL_MUSE,2:SfUtil.ADDITIONAL_CENTER_SKILL_AQOURS,3:SfUtil.ADDITIONAL_CENTER_SKILL_FIRST,4:SfUtil.ADDITIONAL_CENTER_SKILL_SECOND,5:SfUtil.ADDITIONAL_CENTER_SKILL_THIRD,6:SfUtil.ADDITIONAL_CENTER_SKILL_BIBI,7:SfUtil.ADDITIONAL_CENTER_SKILL_LILYWHITE,8:SfUtil.ADDITIONAL_CENTER_SKILL_PRINTEMPS,9:SfUtil.ADDITIONAL_CENTER_SKILL_GUILTYKISS,10:SfUtil.ADDITIONAL_CENTER_SKILL_AZALEA,11:SfUtil.ADDITIONAL_CENTER_SKILL_CYARON,12:SfUtil.ADDITIONAL_CENTER_SKILL_MUSE_6,13:SfUtil.ADDITIONAL_CENTER_SKILL_AQOURS_6},T.DATA_NAME_MAP={"穂乃果":"1.穂乃果","絵里":"2.絵里","ことり":"3.ことり","海未":"4.海未","凛":"5.凛","真姫":"6.真姫","希":"7.希","花陽":"8.花陽","にこ":"9.にこ","千歌":"11.千歌","梨子":"12.梨子","果南":"13.果南","ダイヤ":"14.ダイヤ","曜":"15.曜","善子":"16.善子","花丸":"17.花丸","鞠莉":"18.鞠莉","ルビィ":"19.ルビィ","理亞":"21.理亞","聖良":"22.聖良"},T.DATA_ATTRIBUTE_MAP={smile:"1.スマイル",pure:"2.ピュア",cool:"3.クール"},T.DATA_RARITY_MAP={sr:"1.SR",ssr:"2.SSR",ur:"3.UR"},T.DATA_CENTER_SKILL_MAP={smile:{1:"1.スマイルパワー",2:"2.スマイルハート",3:"3.スマイルスター",4:"4.スマイルプリンセス",5:"5.スマイルエンジェル",6:"6.スマイルエンプレス"},pure:{1:"1.ピュアパワー",2:"2.ピュアハート",3:"3.ピュアスター",4:"4.ピュアプリンセス",5:"5.ピュアエンジェル",6:"6.ピュアエンプレス"},cool:{1:"1.クールパワー",2:"2.クールハート",3:"3.クールスター",4:"4.クールプリンセス",5:"5.クールエンジェル",6:"6.クールエンプレス"}},T.DATA_ADDITIONAL_CENTER_SKILL_MAP={1:"1.μ's",2:"2.Aqours",3:"3.1年生",4:"4.2年生",5:"5.3年生",6:"6.BiBi",7:"7.lily white",8:"8.Printemps",9:"9.Guilty Kiss",10:"10.AZALEA",11:"11.CYaRon！",12:"12.μ's 6%",13:"11.Aqours 6%"},T}();